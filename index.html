<!DOCTYPE html>
<head>
<title>Match-the-pairs</title>
<style>
#card {
	background-color: #FBFFE5;
	border: 1px solid;
	margin: 2px;
	padding: 10px;
	width: 99%;
	text-align: center;
	position: relative;
	font-family: Sans serif;
}

</style>
</head>
<body>
<div id="page-wrapper">

		<div>
			<input type="button" style="position: relative; width: 50px; height: 50px; font-size=100%;" value="R" onMouseDown="window.location.href=window.location.href">
			<input style="height=100%; width=100px;" type="file" id="fileInput">
		</div>

<div>
    <div style="float: left; width: 49%" id="cards" name="LeftPanel"></div>
    <div style="float: right; width: 49%" id="cards" name="RightPanel"></div>
</div>

	</div>
<script>
function shuffle(array) {
	var currentIndex = array.length,
		temporaryValue, randomIndex;
	// While there remain elements to shuffle...
	while (0 !== currentIndex) {
		// Pick a remaining element...
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;
		// And swap it with the current element.
		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}
	return array;
}
var currentSelection = new Array;
var drop = new Audio('drop.wav');
var select = new Audio('select.wav');

function processclick(elmt) {
	select.play();
	var text = elmt.innerHTML;
	elmt.style.backgroundColor = "#EBFF95";
	if (currentSelection.indexOf(text) == -1) {
		elmt.style.backgroundColor = "#EBFF95";
		currentSelection.push(text);
	} else {
		elmt.style.backgroundColor = "#FBFFE5";
		currentSelection.splice(currentSelection.indexOf(text), 1);
	}
	if (currentSelection.length == 0) {
		decolorall();
	}
	if (currentSelection.length == 2) {
		var sample1 = currentSelection[0] + "	" + currentSelection[1];
		var sample2 = currentSelection[1] + "	" + currentSelection[0];
		if (sample1 == sample2) {
			decolorall();
		}
		for (var i in cardListSelected) {
			if (cardListSelected[i] == sample1 || cardListSelected[i] == sample2) {
				var cards = document.getElementsByName("card");
				for (var i in cards) {
					if (cards[i].innerHTML == currentSelection[0] || cards[i].innerHTML ==
						currentSelection[1]) {
						card[i].parentNode.removeChild(card[i]);
					}
				}
				currentSelection = [];
				drop.play();
				break;
			}
		}
	}
	if (currentSelection.length > 2) {
		currentSelection = [];
		decolorall();
	}

numcards = document.getElementsByName("card").length;
if (numcards == 2){
cleanup();
}
}

function decolorall() {
	var cards = document.getElementsByName("card");
	for (var i in cards) {
		cards[i].style.backgroundColor = "#FBFFE5";
	}
}

function cleanup() {
	var cards = document.getElementsByName("card");
	for (var i in cards) {
		delete cards[i];
	}
}

window.onload = function() {
	var fileInput = document.getElementById('fileInput');
	var fileDisplayArea = document.getElementById('fileDisplayArea');
	fileInput.addEventListener('change', function(e) {
		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function(e) {
			var fileText = reader.result;
			cardList = fileText.split("\n");
			shuffle(cardList);
			cardListSelected = cardList.splice(0,10);
			var fronts = new Array
			var backs = new Array
			for (var i in cardListSelected) {
				tempArray = cardListSelected[i].split("\t");
				fronts.push(tempArray[0]);
				backs.push(tempArray[1]);
			}
			shuffle(fronts);
			shuffle(backs);
			var lp = document.getElementsByName("LeftPanel")[0];
			var rp = document.getElementsByName("RightPanel")[0];
			for (var i in fronts) {
				var card = document.createElement('div');
				card.setAttribute('id', 'card');
				card.setAttribute('name', 'card');
				card.setAttribute('onMouseDown', 'processclick(this)');
				card.innerHTML = fronts[i];
				lp.appendChild(card);
			}
			for (var i in backs) {
				var card = document.createElement('div');
				card.setAttribute('id', 'card');
				card.setAttribute('name', 'card');
				card.setAttribute('onMouseDown', 'processclick(this)');
				card.innerHTML = backs[i];
				rp.appendChild(card);
			}
		}
		reader.readAsText(file);
	});
}
</script>
</body>
