<!DOCTYPE html>
<head>
<title>Match-the-pairs</title>
<style>
#card {
	background-color: #FBFFE5;
	border: 1px solid;
	width: 100%;
	padding: 5px;
	font-size:27px;
	text-align: center;
	font-family: Sans serif;
}

</style>
</head>
<body>
<div id="page-wrapper">

		<div>
			<input type="button" style="position: relative; width: 50px; height: 50px; font-size=100%;" value="R" onMouseDown="window.location.href=window.location.href">
			<input style="height=100%; width=100px;" type="file" id="fileInput">
		</div>

<div>
    <div style="float: left; width: 49%; height:100%;" id="cards" name="LeftPanel"></div>
    <div style="float: right; width: 49%; height:100%;" id="cards" name="RightPanel"></div>
</div>

	</div>
<script>
// Shuffles the array
function shuffle(array) {
	var currentIndex = array.length,
		temporaryValue, randomIndex;
	// While there remain elements to shuffle...
	while (0 !== currentIndex) {
		// Pick a remaining element...
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;
		// And swap it with the current element.
		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}
	return array;
}

// Declare global variables
var currentSelection = new Array;
var drop = new Audio('drop.wav');
var select = new Audio('select.wav');

// Process click event
function processclick(elmt) {
	///select.play();
	// Get text value of clicke element
	var text = elmt.innerHTML;
	// Change color of clicked element to show as selected
	elmt.style.backgroundColor = "#EBFF95";
	if (currentSelection.indexOf(text) == -1) { // If selection is not in comparison array, push to array
		elmt.style.backgroundColor = "#EBFF95";
		currentSelection.push(text);
	} else {
		elmt.style.backgroundColor = "#FBFFE5";
		currentSelection.splice(currentSelection.indexOf(text), 1); // else delete it from array when it is reselected
	}
	
	// If I deselect first selected element, decolorize all elements #dirty
	if (currentSelection.length == 0) {
		decolorall();
	}
	// When I have two values in comparison array, process it
	if (currentSelection.length == 2) {
		// Create two samples for comparison
		var sample1 = currentSelection[0] + "	" + currentSelection[1];
		var sample2 = currentSelection[1] + "	" + currentSelection[0];
		// Some cards may have same text, if such cards are selected, decolor everything
		if (sample1 == sample2) {
			decolorall();
		}
		for (var i in cardListSelected) {
			if (cardListSelected[i] == sample1 || cardListSelected[i] == sample2) { // if a match is found, that is correct matched pair,
				var cards = document.getElementsByName("card");
				for (var i in cards) {
					if (cards[i].innerHTML == currentSelection[0]) {
						card[i].parentNode.removeChild(card[i]); // pop those cards out of stack
						break; // because I don't want to delete multiple elements with same values
					}
				}
				for (var i in cards) {
					if (cards[i].innerHTML == currentSelection[1]) {
						card[i].parentNode.removeChild(card[i]); // the second one too!
						break; // because I don't want to delete multiple elements with same values
					}
				}
				currentSelection = [];
				drop.play(); // Play the quick funny sound
				break; // work is done, stop cycling
			}
		}
	}

	// If user selects more than 2 elements, reset arrays and colors
	if (currentSelection.length > 2) {
		currentSelection = [];
		decolorall();
	}

// If last two cards are remaining, delete them #NotWorking!?
numcards = document.getElementsByName("card").length;
if (numcards == 2){
cleanup();
}
}

// Dirty decolorizer
function decolorall() {
	var cards = document.getElementsByName("card");
	for (var i in cards) {
		cards[i].style.backgroundColor = "#FBFFE5";
	}
}

// Redundant cleanup, TODO
function cleanup() {
	var cards = document.getElementsByName("card");
	for (var i in cards) {
		delete cards[i];
	}
}

/// Main activity
window.onload = function() {
	var fileInput = document.getElementById('fileInput');
	var fileDisplayArea = document.getElementById('fileDisplayArea');
	fileInput.addEventListener('change', function(e) {
		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function(e) {
			var fileText = reader.result; // Read file contents
			cardList = fileText.split("\n"); // Load file contents into array
			shuffle(cardList);
			cardListSelected = cardList.splice(0,10); // I only want 10 random cards, because too many match the pairs!
			var fronts = new Array
			var backs = new Array
			for (var i in cardListSelected) { // Create separate arrays for front and back
				tempArray = cardListSelected[i].split("\t");
				fronts.push(tempArray[0]);
				backs.push(tempArray[1]);
			}
			shuffle(fronts);
			shuffle(backs);
			var lp = document.getElementsByName("LeftPanel")[0];
			var rp = document.getElementsByName("RightPanel")[0];
			for (var i in fronts) { // Spawn front sides of cards on left panel
				var card = document.createElement('div');
				card.setAttribute('id', 'card');
				card.setAttribute('name', 'card');
				card.setAttribute('onMouseDown', 'processclick(this)');
				card.innerHTML = fronts[i];
				lp.appendChild(card);
			}
			for (var i in backs) { // Spawn back sides of cards on right panel
				var card = document.createElement('div');
				card.setAttribute('id', 'card');
				card.setAttribute('name', 'card');
				card.setAttribute('onMouseDown', 'processclick(this)');
				card.innerHTML = backs[i];
				rp.appendChild(card);
			}
		}
		reader.readAsText(file); // ??
	});
}
</script>
</body>
